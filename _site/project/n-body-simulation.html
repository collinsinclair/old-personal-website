<!doctype html>

<html class="no-js" lang="en">

<head>


	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	Collin Sinclair

	Personal Theme by https://jekyllthemes.io
	Premium + free Jekyll themes for your blog or website.

	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/images/favicon.png">
	<title>N-Body Simulation – Collin Sinclair</title>
	<meta name="description" content="The story of an N-body simulation &amp;mdash; a program that calculates the motion of gravitationally-bound objects in space &amp;mdash; and what it can teach us about the universe.">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="N-Body Simulation – Collin Sinclair">
	<meta name="twitter:description" content="The story of an N-body simulation &amp;mdash; a program that calculates the motion of gravitationally-bound objects in space &amp;mdash; and what it can teach us about the universe.">
	<meta name="twitter:image:src" content="http://localhost:4000/images/planetesimal-disk.png">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="N-Body Simulation – Collin Sinclair" />
	<meta property="og:description" content="The story of an N-body simulation &amp;mdash; a program that calculates the motion of gravitationally-bound objects in space &amp;mdash; and what it can teach us about the universe." />
	<meta property="og:image" content="http://localhost:4000/images/planetesimal-disk.png" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Muli:300,400,600,700" rel="stylesheet">
	

	<!-- Styles -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	
	<!-- Icons -->
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/solid.js" integrity="sha384-GXi56ipjsBwAe6v5X4xSrVNXGOmpdJYZEEh/0/GqJ3JTHsfDsF8v0YQvZCJYAiGu" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/brands.js" integrity="sha384-0inRy4HkP0hJ038ZyfQ4vLl+F4POKbqnaUB6ewmU4dWP0ki8Q27A0VFiVRIpscvL" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/fontawesome.js" integrity="sha384-NY6PHjYLP2f+gL3uaVfqUZImmw71ArL9+Roi9o+I4+RBqArA2CfW1sJ1wkABFfPe" crossorigin="anonymous"></script>

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	
</head>


<body class="loading ajax-loading" data-site-url="http://localhost:4000" data-page-url="/project/n-body-simulation">


	<header class="header">

	<div class="wrap">

		
		<a href="/" class="header__title">
			Collin Sinclair
		</a>
		

		<div class="menu">
			<div class="menu__toggle js-menu-toggle">
				<div class="menu__toggle__icon"><span></span></div>
			</div>
			<div class="menu__wrap">
				<ul class="menu__list">
					
					<li class="menu__list__item">
						<a href="/" class="menu__list__item__link">Projects</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/blog/" class="menu__list__item__link">Blog</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/about" class="menu__list__item__link">About</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/contact" class="menu__list__item__link">Contact</a>
					</li>
					
				</ul>
			</div>
		</div>

	</div>

</header>


	<div class="loader"><svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle></svg></div>

	<div class="page-loader"></div>

	
	<div class="page">

		<div class="page__content" data-page-title="N-Body Simulation – Collin Sinclair">

			<section class="hero hero--single">

	<div class="hero__image" style="background-image: url(/images/planetesimal-disk.png)">
		<div class="hero__overlay"></div>
	</div>

	<div class="wrap">

		<h1>N-Body Simulation</h1>
		<p>An astronomer&apos;s perspective</p>

	</div>

</section>

<section class="single">

	<div class="wrap">

		<article class="single-post">

			<h2 id="backstory">Backstory</h2>

<p>Imagine a whole bunch of stuff (preferably coalesced into bodies like stars or planets) out there in space. Anywhere, anytime. Just, <em>imagine</em>. What are those things doing? Are they still? Spinning? Moving towards or away from one another? If only we could look at it for ourselves… But wait, <strong>we can!</strong> – and this tool (or toy?) can help.</p>

<p>This <em>N-Body Simulation</em> started its life as my final project for CU Boulder’s ASTR 2600: Introduction to Scientific Programming, but back then I didn’t know what I was doing or how to do it, at least as far as useful programs go. So I decided to give that old IPython notebook a facelift and turn it into something others could experience and (hopefully) learn from.</p>

<p>But wait, what <em>is</em> an N-Body simulation? First, it’s worth discussing something called the “N-Body Problem” – a historically difficult problem to solve by hand. Given the current understanding of orbital mechanics (how gravitationally bound objects move in space), finding an analytical (i.e., <strong>not</strong> step-by-step) solution for the motion of even a three body gravitational system is incredibly tricky – let alone dozens of bodies.</p>

<p>The beauty of programming a computer to do this work for us is that we don’t need an analytical solution – we can have the computer run the process step-by-step to show us a “really good” approximation of the motion of the bodies. That is exactly what this program is doing, and that is the essence of an N-Body simulation.</p>

<h2 id="the-program">The Program</h2>

<p>Under the hood, the program starts by creating some lists of numbers representing the positions and starting velocities (in three dimensions) of particles in space. These initial conditions are user-selected and either hard-coded/predetermined (in the case of some of the geometric examples like the figure-8 or uniform cube) or “intelligently” generated (in the case of more realistic systems like the planetesimal disk or tiny star cluster).</p>

<p>From here – after a few more user customizations – the program begins the simulation, stepping all of the particles forward through time, moment by moment. Specifically, it uses the <a href="https://en.wikipedia.org/wiki/Runge–Kutta_methods">Runge-Kutta method</a>, which is a mathematical method for calculating numbers from one discrete moment of time to another.</p>

<p>This method was suggested and implemented by Brandon Korb<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, after my initial Euler method algorithm resulted in significant loss of energy. This is a major issue with these kinds of simulations: when massive bodies pass very close to one another, the gravitational force (which increases as the distance between objects decreases) grows to effectively infinity, which means that the objects experience incredibly large accelerations (remember: <em>a = f / m</em>), and in discrete timesteps an object will travel a large distance before the next force is calculated. Once the object moves this large distance from this huge acceleration, it is no longer near enough to the object that caused this slingshot effect to be slowed down by gravity (the force due to gravity <em>decreases</em> as distance increases, and quickly). In this way, these close fly-bys can produce very non-physical results, breaking the conservation of energy.</p>

<p>So, back to the Runge-Kutta method: this way of iterating over timesteps to calculate forces, velocities, and positions is specifically designed to minimize these crazy effects, but it isn’t perfect. In some of the examples below, you’ll see phenomena that probably wouldn’t happen out there in actual space (also gravitational slingshotting a <em>does</em> happen, and it’s how we do a lot a interplanetary space travel), just not to the extent that we see here.</p>

<h2 id="visualization">Visualization</h2>

<p>There are a couple of interesting things to consider regarding the visual aspect of the program. I opted for a dark background with a <a href="https://colorcet.com">perceptually uniform colormap</a> to invoke a space-y feeling.</p>

<p>The 3D simulation is presented from three angles: edge-on, face-on, and isometric, to provide maximum understanding of the relative positions and motions of the bodies. I’ve also included a plot of the <em>kinetic energy</em> of the bodies (whose colors match those of the bodies) to demonstrate some of the strange interactions described above.</p>

<p>The sizes of the bodies are scaled to demonstrate their relative masses (especially obvious in the planetary systems and tiny cluster), though things aren’t perfectly proportional because in reality stars are <em>so</em> much more massive than planets that either</p>

<ol>
  <li>the star would fill up the whole screen or</li>
  <li>the planets would be invisible.</li>
</ol>

<p>And yes, this assumes that all bodies have the same density (which is not true in reality).</p>

<p>The sizes of the bodies are also designed to respond to situations where objects get ejected, displaying a sort of zoom-out effect as the bounds of the plots grow larger (another feature implemented by Brandon).</p>

<h2 id="insights">Insights</h2>

<p>Here is the first and most basic of the simulations: it’s just the Sun and the Earth! And because I haven’t programmed in any sort of friction or otherwise resistive forces, nothing is changing!</p>

<div style="padding:33.44% 0 0 0;position:relative;"><iframe src="https://player.vimeo.com/video/666336304?h=e41f4961b6&amp;badge=0&amp;autopause=0&amp;player_id=0&amp;app_id=58479" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen="" style="position:absolute;top:0;left:0;width:100%;height:100%;" title="SunEarth_2022-01-15-11-47-46"></iframe></div>
<script src="https://player.vimeo.com/api/player.js"></script>

<p>Read more about the <a href="https://en.wikipedia.org/wiki/N-body_problem">N-Body Problem</a> or <a href="https://en.wikipedia.org/wiki/N-body_simulation">N-Body Simulations</a>.</p>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>a close friend, former roommate, and the one who got me into computer science. Check out <a href="http://brandonkorb.com">his site</a>. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


		</article>

	</div>

</section>

		</div>

	</div>


	<footer class="footer">

	<div class="wrap">

		<p class="footer__text">The personal website of Collin Sinclair&#58; developer, educator, and musician.</p>

		<div class="footer__copyright">
			<span>© 2022 Collin Sinclair</span>
			<a href="https://jekyllthemes.io" target="_blank">Jekyll Themes</a>
		</div>

		<ul class="socials">
	
	
	
	
	<li class="socials__item">
		<a href="https://twitter.com/collinmsinclair" target="_blank" class="socials__item__link" title="Twitter">
			<i class="fab fa-twitter" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	<li class="socials__item">
		<a href="https://www.instagram.com/collinsinclair88/" target="_blank" class="socials__item__link" title="Instagram">
			<i class="fab fa-instagram" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://github.com/collinsinclair" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://www.linkedin.com/in/collinsinclair/" target="_blank" class="socials__item__link" title="Linkedin">
			<i class="fab fa-linkedin" aria-hidden="true"></i>
		</a>
	</li>
	
	
</ul>

	</div>

</footer>


	<!-- Javascript Assets -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/js/plugins-min.js"></script>
	<script src="/js/personal-min.js"></script>

	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>